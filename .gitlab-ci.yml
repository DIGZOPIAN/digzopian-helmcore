# .gitlab-ci.yml

stages:
  - setup
  - lint
  - test
  - deploy

variables:
  PROJECT_ENV: "production"
  FLASK_APP: main.py
  PYTHONUNBUFFERED: 1

before_script:
  - python3 -V
  - pip install --upgrade pip
  - pip install -r requirements.txt

setup:
  stage: setup
  script:
    - echo "ğŸ”§ Setting up Python environment..."
    - pip list

lint:
  stage: lint
  script:
    - echo "ğŸ” Linting code with flake8..."
    - pip install flake8
    - flake8 . --ignore=E501,W503

test:
  stage: test
  script:
    - echo "ğŸ§ª Running basic boot test for $FLASK_APP..."
    - python $FLASK_APP & sleep 5 && curl -I http://localhost:5000 || echo "âŒ Failed to boot"

deploy:
  stage: deploy
  script:
    - echo "ğŸš€ Deploy logic goes here â€” VPS, Replit, or Gitpod push"
  only:
    - main